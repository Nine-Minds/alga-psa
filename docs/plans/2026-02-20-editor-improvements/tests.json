[
  {
    "id": "T001",
    "description": "Feature flag 'collaborative_editing' exists in DEFAULT_BOOLEAN_FLAGS and defaults to false",
    "implemented": false,
    "featureIds": ["F001"],
    "testType": "integration",
    "testFile": "server/src/test/integration/collaborativeEditing.integration.test.ts",
    "vitestName": "should have collaborative_editing flag defaulting to false"
  },
  {
    "id": "T002",
    "description": "/msp/collab-test returns 'Feature not available' message when collaborative_editing flag is disabled",
    "implemented": false,
    "featureIds": ["F015"],
    "testType": "manual",
    "notes": "Verify in browser with flag disabled"
  },
  {
    "id": "T003",
    "description": "/msp/collab-test renders the test page UI when collaborative_editing flag is enabled",
    "implemented": false,
    "featureIds": ["F015"],
    "testType": "manual",
    "notes": "Verify in browser with flag enabled"
  },
  {
    "id": "T004",
    "description": "CollaborativeEditor mounts and initializes TipTap with Collaboration and CollaborationCaret extensions without errors",
    "implemented": false,
    "featureIds": ["F003"],
    "testType": "manual",
    "notes": "Open test page, check browser console for errors"
  },
  {
    "id": "T005",
    "description": "CollaborativeEditor creates HocuspocusProvider with correct room name format 'document:<tenant>:<documentId>'",
    "implemented": false,
    "featureIds": ["F004"],
    "testType": "integration",
    "testFile": "server/src/test/integration/collaborativeEditing.integration.test.ts",
    "vitestName": "should construct room name as document:<tenant>:<documentId>"
  },
  {
    "id": "T006",
    "description": "CollaborativeEditor connects to Hocuspocus server successfully (connection status shows 'connected')",
    "implemented": false,
    "featureIds": ["F004", "F008"],
    "testType": "manual",
    "notes": "Open test page with Hocuspocus running, verify green connection indicator"
  },
  {
    "id": "T007",
    "description": "EditorToolbar (BubbleMenu) appears when text is selected in CollaborativeEditor",
    "implemented": false,
    "featureIds": ["F005"],
    "testType": "manual",
    "notes": "Type text, select it, verify BubbleMenu appears"
  },
  {
    "id": "T008",
    "description": "Bold, italic, underline, strikethrough, code formatting works in collaborative mode",
    "implemented": false,
    "featureIds": ["F005"],
    "testType": "manual",
    "notes": "Apply each formatting via BubbleMenu, verify it sticks"
  },
  {
    "id": "T009",
    "description": "Heading 1, Heading 2, bullet list, ordered list, blockquote work in collaborative mode",
    "implemented": false,
    "featureIds": ["F005"],
    "testType": "manual",
    "notes": "Apply each block type via BubbleMenu, verify rendering"
  },
  {
    "id": "T010",
    "description": "Link insertion/editing works via toolbar in collaborative mode",
    "implemented": false,
    "featureIds": ["F005"],
    "testType": "manual",
    "notes": "Insert link via BubbleMenu, verify href is saved"
  },
  {
    "id": "T011",
    "description": "Two users editing the same document see each other's cursor with name label and distinct color",
    "implemented": false,
    "featureIds": ["F006"],
    "testType": "manual-multiuser",
    "notes": "Two browser tabs (regular + incognito), same doc URL, verify colored cursors with names"
  },
  {
    "id": "T012",
    "description": "Cursor color assignment is deterministic per user (same user always gets same color)",
    "implemented": false,
    "featureIds": ["F006"],
    "testType": "manual-multiuser",
    "notes": "Reload page, verify same user gets same color"
  },
  {
    "id": "T013",
    "description": "Presence bar shows both users' names when two users are connected to the same document",
    "implemented": false,
    "featureIds": ["F007"],
    "testType": "manual-multiuser",
    "notes": "Two tabs connected, verify presence bar shows both names"
  },
  {
    "id": "T014",
    "description": "Presence bar updates when a user disconnects (name disappears)",
    "implemented": false,
    "featureIds": ["F007"],
    "testType": "manual-multiuser",
    "notes": "Close one tab, verify name disappears from presence bar in remaining tab"
  },
  {
    "id": "T015",
    "description": "Connection status shows 'connected' (green) when WebSocket is open",
    "implemented": false,
    "featureIds": ["F008"],
    "testType": "manual",
    "notes": "Open test page with Hocuspocus running"
  },
  {
    "id": "T016",
    "description": "Connection status shows 'disconnected' (red) when WebSocket drops",
    "implemented": false,
    "featureIds": ["F008"],
    "testType": "manual",
    "notes": "Stop Hocuspocus server while editor is open, verify red indicator"
  },
  {
    "id": "T017",
    "description": "Auto-save indicator shows 'All changes saved' after edits sync to Hocuspocus",
    "implemented": false,
    "featureIds": ["F009"],
    "testType": "manual",
    "notes": "Type text, wait a moment, verify status text"
  },
  {
    "id": "T018",
    "description": "No manual 'Save' button exists in CollaborativeEditor",
    "implemented": false,
    "featureIds": ["F009"],
    "testType": "manual",
    "notes": "Visually confirm no Save button in the editor UI"
  },
  {
    "id": "T019",
    "description": "Pasting markdown text converts to rich text in collaborative editor",
    "implemented": false,
    "featureIds": ["F010"],
    "testType": "manual",
    "notes": "Copy markdown (e.g. '## Hello\\n- item'), paste into editor, verify conversion"
  },
  {
    "id": "T020",
    "description": "Hocuspocus onConnect rejects connection when room name tenant does not match user tenant",
    "implemented": false,
    "featureIds": ["F011"],
    "testType": "integration",
    "testFile": "server/src/test/integration/collaborativeEditing.integration.test.ts",
    "vitestName": "should reject room name with mismatched tenant"
  },
  {
    "id": "T021",
    "description": "Hocuspocus onConnect allows connection when room name tenant matches user tenant",
    "implemented": false,
    "featureIds": ["F011"],
    "testType": "integration",
    "testFile": "server/src/test/integration/collaborativeEditing.integration.test.ts",
    "vitestName": "should allow room name with matching tenant"
  },
  {
    "id": "T022",
    "description": "Hocuspocus onConnect allows notification rooms (notifications:*) to pass through without document validation",
    "implemented": false,
    "featureIds": ["F012"],
    "testType": "integration",
    "testFile": "server/src/test/integration/collaborativeEditing.integration.test.ts",
    "vitestName": "should pass through notification rooms without document validation"
  },
  {
    "id": "T023",
    "description": "Content typed in the editor persists across full page refresh (Hocuspocus DB persistence)",
    "implemented": false,
    "featureIds": ["F013"],
    "testType": "manual",
    "notes": "Type text, refresh page, verify content reloads"
  },
  {
    "id": "T024",
    "description": "Changes made by user A appear in real-time for user B without page refresh",
    "implemented": false,
    "featureIds": ["F013"],
    "testType": "manual-multiuser",
    "notes": "Two tabs, type in one, verify appears in the other instantly"
  },
  {
    "id": "T025",
    "description": "syncCollabSnapshot writes correct TipTap JSON to document_block_content.block_data for the given documentId",
    "implemented": false,
    "featureIds": ["F014"],
    "testType": "integration",
    "testFile": "server/src/test/integration/collaborativeEditing.integration.test.ts",
    "vitestName": "should update block_data when syncing a snapshot from collab state"
  },
  {
    "id": "T026",
    "description": "syncCollabSnapshot returns error if documentId does not exist",
    "implemented": false,
    "featureIds": ["F014"],
    "testType": "integration",
    "testFile": "server/src/test/integration/collaborativeEditing.integration.test.ts",
    "vitestName": "should return null block_data for non-existent document"
  },
  {
    "id": "T027",
    "description": "'Create New Document' button on test page creates a document and navigates to ?doc=<newId>",
    "implemented": false,
    "featureIds": ["F016"],
    "testType": "manual",
    "notes": "Click Create New, verify URL changes and editor loads"
  },
  {
    "id": "T028",
    "description": "Opening /msp/collab-test?doc=<existingId> loads the collaborative editor for that document",
    "implemented": false,
    "featureIds": ["F017"],
    "testType": "manual",
    "notes": "Navigate to URL with valid doc ID, verify editor loads content"
  },
  {
    "id": "T029",
    "description": "Opening /msp/collab-test?doc=<nonExistentId> shows an error message",
    "implemented": false,
    "featureIds": ["F017"],
    "testType": "manual",
    "notes": "Navigate to URL with bogus doc ID, verify error"
  },
  {
    "id": "T030",
    "description": "'Snapshot to DB' button calls syncCollabSnapshot and shows success toast",
    "implemented": false,
    "featureIds": ["F018"],
    "testType": "manual",
    "notes": "Click Snapshot to DB, verify toast and check document_block_content table"
  },
  {
    "id": "T031",
    "description": "Debug panel shows connection status, connected user count, and room name",
    "implemented": false,
    "featureIds": ["F019"],
    "testType": "manual",
    "notes": "Open debug panel on test page, verify all fields populated"
  },
  {
    "id": "T032",
    "description": "When Hocuspocus document is empty and document_block_content has existing content, the Y.js document is initialized from block_data",
    "implemented": false,
    "featureIds": ["F020"],
    "testType": "integration",
    "testFile": "server/src/test/integration/collaborativeEditing.integration.test.ts",
    "vitestName": "should load existing block_data as TipTap-compatible JSON for Y.js initialization"
  },
  {
    "id": "T033",
    "description": "When Hocuspocus document already has Y.js state, existing block_data is NOT used (Y.js state takes precedence)",
    "implemented": false,
    "featureIds": ["F020"],
    "testType": "manual",
    "notes": "Edit via collab, manually change DB content, reload â€” should show collab version"
  },
  {
    "id": "T034",
    "description": "CollaborativeEditor is exported from packages/documents/src/components/index.ts",
    "implemented": false,
    "featureIds": ["F021"],
    "testType": "build",
    "notes": "Verify import works: import { CollaborativeEditor } from '@alga-psa/documents/components'"
  },
  {
    "id": "T035",
    "description": "Collaboration cursor labels use design system CSS variables (--color-*) and are readable in both light and dark themes",
    "implemented": false,
    "featureIds": ["F022"],
    "testType": "manual",
    "notes": "Toggle dark/light mode, verify cursor labels readable in both"
  },
  {
    "id": "T036",
    "description": "Two users from different tenants connecting to the same document ID are routed to different Hocuspocus rooms (tenant isolation)",
    "implemented": false,
    "featureIds": ["F011"],
    "testType": "integration",
    "testFile": "server/src/test/integration/collaborativeEditing.integration.test.ts",
    "vitestName": "should produce different room names for same doc in different tenants"
  },
  {
    "id": "T037",
    "description": "Concurrent formatting operations from two users do not corrupt the document (Y.js CRDT conflict resolution)",
    "implemented": false,
    "featureIds": ["F003", "F013"],
    "testType": "manual-multiuser",
    "notes": "Two tabs, both bold different words simultaneously, verify no corruption"
  }
]
