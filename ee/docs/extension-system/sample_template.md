# Sample Extension Template (Runner + Iframe UI)

This template outlines a minimal extension composed of:
- Server handlers compiled to WASM and executed by the Runner
- An iframe UI built with React using the Alga UI kit and SDK
- A Manifest v2 that declares endpoints and the UI entry

## File Structure

```
my-extension/
├── src/
│   ├── http/
│   │   ├── list_agreements.ts
│   │   └── sync.ts
│   └── ui/
│       ├── index.html
│       └── src/
│           ├── main.tsx
│           └── components/
├── dist/
│   ├── handlers/http/list_agreements.wasm   # built artifact(s)
│   └── ui/                                  # built iframe assets
├── manifest.json
├── SIGNATURE                                # generated by CI
├── package.json
└── README.md
```

## Manifest v2

```json
{
  "name": "com.example.agreements",
  "publisher": "Example, Inc.",
  "version": "1.0.0",
  "runtime": "wasm-js@1",
  "capabilities": ["http.fetch", "storage.kv"],
  "ui": { "type": "iframe", "entry": "ui/index.html" },
  "api": {
    "endpoints": [
      { "method": "GET", "path": "/agreements", "handler": "dist/handlers/http/list_agreements" },
      { "method": "POST", "path": "/agreements/sync", "handler": "dist/handlers/http/sync" }
    ]
  },
  "assets": ["ui/**/*"]
}
```

## WASM Handler (conceptual)

```ts
// src/http/list_agreements.ts
export async function list_agreements(ctx) {
  const items = await ctx.storage.list({ namespace: 'agreements' });
  return { status: 200, headers: { 'content-type': 'application/json' }, body: { data: items } };
}
```

Build to `dist/handlers/http/list_agreements.wasm` via your language toolchain.

## Iframe UI (React)

```tsx
// ui/src/main.tsx
import React, { useEffect, useState } from 'react';
import { createRoot } from 'react-dom/client';
import { useExtension, BridgeProvider } from '@alga/extension-iframe-sdk';
import { DataTable } from '@alga/ui-kit';

function App() {
  const { context } = useExtension();
  const [rows, setRows] = useState<any[]>([]);

  useEffect(() => {
    async function load() {
      const res = await fetch(`/api/ext/${context.extensionId}/agreements`, { headers: context.authHeaders });
      const data = await res.json();
      setRows(Array.isArray(data) ? data : data.data ?? []);
    }
    load();
  }, [context.extensionId, context.authHeaders]);

  return <DataTable columns={[{ key: 'name', header: 'Name' }]} rows={rows} />;
}

createRoot(document.getElementById('root')!).render(
  <BridgeProvider>
    <App />
  </BridgeProvider>
);
```

## Packaging & Signing

- Produce bundle with `manifest.json`, WASM artifacts under `dist/`, UI assets under `ui/`
- Compute SHA256 over canonical bundle
- Sign using your publisher certificate; write `SIGNATURE`
- Publish to the Registry (CI step)

## Install & Use

- Tenant admin installs a specific version and grants capabilities
- UI entry can be opened at `/ext-ui/{extensionId}/{content_hash}/index.html`
- Client and internal code call handlers via `/api/ext/{extensionId}/...`

## Notes

- Do not rely on server filesystem paths; all artifacts are loaded from object storage by content hash
- Keep responses small; paginate lists
- Use the SDK‑provided headers for authentication; do not forward end‑user tokens

See also: [Development Guide](development_guide.md), [Manifest v2](manifest_schema.md), and [API Routing Guide](api-routing-guide.md).
