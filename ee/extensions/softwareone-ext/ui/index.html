<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>SoftwareOne Extension</title>
    <style>
      :root {
        --alga-bg: #fff;
        --alga-fg: #111827;
        --alga-muted-fg: #6b7280;
        --alga-border: #e5e7eb;
        --alga-primary: #2563eb;
        --alga-primary-foreground: #ffffff;
        --alga-success: #16a34a;
        --alga-warning: #d97706;
        --alga-danger: #dc2626;
      }
      body { margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; color: var(--alga-fg); }
      header { display: flex; align-items: center; justify-content: space-between; padding: 12px 16px; border-bottom: 1px solid var(--alga-border); position: sticky; top: 0; background: #fff; z-index: 10; }
      nav a { margin-right: 12px; color: var(--alga-primary); text-decoration: none; font-weight: 500; }
      nav a.active { text-decoration: underline; }
      main { padding: 16px; }
    </style>
    <script type="importmap">
      {
        "imports": {
          "react": "https://esm.sh/react@18",
          "react-dom": "https://esm.sh/react-dom@18",
          "react-dom/client": "https://esm.sh/react-dom@18/client",
          "react/jsx-runtime": "https://esm.sh/react@18/jsx-runtime",
          "react/jsx-dev-runtime": "https://esm.sh/react@18/jsx-dev-runtime",
          "react-router-dom": "https://esm.sh/react-router-dom@6?deps=react@18,react-dom@18",
          "formik": "https://esm.sh/formik@2?deps=react@18,react-dom@18",
          "yup": "https://esm.sh/yup@1",
          "@tanstack/react-query": "https://esm.sh/@tanstack/react-query@4?deps=react@18"
        }
      }
    </script>
  </head>
  <body>
    <header>
      <strong>SoftwareOne Extension</strong>
      <nav>
        <a href="#/agreements">Agreements</a>
        <a href="#/statements">Statements</a>
        <a href="#/settings">Settings</a>
      </nav>
    </header>
    <main>
      <div id="root"></div>
    </main>

    <script type="module">
      // Load compiled TSX React app from the content-addressed base when available.
      const path = window.location.pathname;
      const hashMatch = path.match(/^(.*?\/sha256:[^/]+\/)/);
      const base = hashMatch ? hashMatch[1] : (path.endsWith('/') ? path : path.slice(0, path.lastIndexOf('/') + 1));
      const candidates = [
        `${base}dist/iframe/main.js`,           // packaged layout: sha256:<hash>/dist/iframe/main.js
        `${base}ui/dist/iframe/main.js`,        // alternative packaged: sha256:<hash>/ui/dist/iframe/main.js
        new URL('../dist/iframe/main.js', import.meta.url).toString(), // dev layout when served from ui/index.html
        new URL('./dist/iframe/main.js', import.meta.url).toString(),   // fallback
      ];
      let loaded = false;
      for (const url of candidates) {
        try {
          await import(url);
          loaded = true;
          break;
        } catch {}
      }
      if (!loaded) {
        console.error('[SoftwareOne] Failed to load iframe entry from candidates:', candidates);
      }
    </script>
  </body>
  </html>
