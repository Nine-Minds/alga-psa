{
  "format": "alga-psa.workflow-bundle",
  "formatVersion": 1,
  "exportedAt": "2026-01-27T02:06:59.712Z",
  "workflows": [
    {
      "key": "fixture.ticket-created-two-subworkflows",
      "metadata": {
        "name": "Fixture: Ticket Created Two Subworkflows (CallWorkflow)",
        "description": "Call a sub-workflow and assert both parent+child side effects (TICKET_CREATED).",
        "payloadSchemaRef": "payload.TicketCreated.v1",
        "payloadSchemaMode": "pinned",
        "pinnedPayloadSchemaRef": "payload.TicketCreated.v1",
        "trigger": {
          "type": "event",
          "eventName": "TICKET_CREATED"
        },
        "isSystem": false,
        "isVisible": true,
        "isPaused": false,
        "concurrencyLimit": null,
        "autoPauseOnFailure": false,
        "failureRateThreshold": null,
        "failureRateMinRuns": null,
        "retentionPolicyOverride": null
      },
      "dependencies": {
        "actions": [
          {
            "actionId": "notifications.send_in_app",
            "version": 1
          }
        ],
        "nodeTypes": [
          "action.call",
          "control.callWorkflow",
          "control.return",
          "state.set",
          "transform.assign"
        ],
        "schemaRefs": [
          "payload.TicketCreated.v1"
        ]
      },
      "draft": {
        "draftVersion": 1,
        "definition": {
          "id": "ad07f680-8b3c-6c76-b095-50923a31528f",
          "version": 1,
          "name": "Fixture: Ticket Created Two Subworkflows (CallWorkflow)",
          "description": "Call a sub-workflow and assert both parent+child side effects (TICKET_CREATED).",
          "payloadSchemaRef": "payload.TicketCreated.v1",
          "trigger": {
            "type": "event",
            "eventName": "TICKET_CREATED"
          },
          "steps": [
            {
              "id": "state-fixture",
              "type": "state.set",
              "config": {
                "state": "FIXTURE"
              }
            },
            {
              "id": "assign-text",
              "type": "transform.assign",
              "config": {
                "assign": {
                  "vars.marker": {
                    "$expr": "'[fixture ticket-created-two-subworkflows]'"
                  },
                  "vars.title": {
                    "$expr": "'[fixture ticket-created-two-subworkflows] Parent'"
                  },
                  "vars.body": {
                    "$expr": "'[fixture ticket-created-two-subworkflows] dedupe=' & payload.fixtureDedupeKey"
                  }
                }
              }
            },
            {
              "id": "call-child",
              "type": "control.callWorkflow",
              "workflowId": "00000000-0000-0000-0000-000000000000",
              "workflowVersion": 1,
              "inputMapping": {
                "fixtureNotifyUserId": {
                  "$expr": "payload.fixtureNotifyUserId"
                },
                "fixtureDedupeKey": {
                  "$expr": "payload.fixtureDedupeKey"
                }
              }
            },
            {
              "id": "notify",
              "type": "action.call",
              "config": {
                "actionId": "notifications.send_in_app",
                "version": 1,
                "inputMapping": {
                  "recipients": {
                    "$expr": "{ \"user_ids\": [payload.fixtureNotifyUserId] }"
                  },
                  "title": {
                    "$expr": "vars.title"
                  },
                  "body": {
                    "$expr": "vars.body"
                  },
                  "severity": "info",
                  "dedupe_key": {
                    "$expr": "'fixture.ticket-created-two-subworkflows:' & payload.fixtureDedupeKey & ':parent'"
                  }
                }
              }
            },
            {
              "id": "done",
              "type": "control.return"
            }
          ]
        }
      },
      "publishedVersions": []
    },
    {
      "key": "subfixture.ticket-created-two-subworkflows",
      "metadata": {
        "name": "Fixture: Ticket Created Two Subworkflows (Child)",
        "description": "Child workflow for callWorkflow fixture ticket-created-two-subworkflows.",
        "payloadSchemaRef": "payload.TicketCreated.v1",
        "payloadSchemaMode": "pinned",
        "pinnedPayloadSchemaRef": "payload.TicketCreated.v1",
        "trigger": null,
        "isSystem": false,
        "isVisible": true,
        "isPaused": false,
        "concurrencyLimit": null,
        "autoPauseOnFailure": false,
        "failureRateThreshold": null,
        "failureRateMinRuns": null,
        "retentionPolicyOverride": null
      },
      "dependencies": {
        "actions": [
          {
            "actionId": "notifications.send_in_app",
            "version": 1
          }
        ],
        "nodeTypes": [
          "action.call",
          "control.return",
          "state.set",
          "transform.assign"
        ],
        "schemaRefs": [
          "payload.TicketCreated.v1"
        ]
      },
      "draft": {
        "draftVersion": 1,
        "definition": {
          "id": "00000000-0000-0000-0000-00000000d612",
          "version": 1,
          "name": "Fixture: Ticket Created Two Subworkflows (Child)",
          "description": "Child workflow for callWorkflow fixture ticket-created-two-subworkflows.",
          "payloadSchemaRef": "payload.TicketCreated.v1",
          "steps": [
            {
              "id": "state-fixture",
              "type": "state.set",
              "config": {
                "state": "FIXTURE"
              }
            },
            {
              "id": "assign-text",
              "type": "transform.assign",
              "config": {
                "assign": {
                  "vars.marker": {
                    "$expr": "'[fixture ticket-created-two-subworkflows child]'"
                  },
                  "vars.title": {
                    "$expr": "'[fixture ticket-created-two-subworkflows child] Child'"
                  },
                  "vars.body": {
                    "$expr": "'[fixture ticket-created-two-subworkflows child] dedupe=' & payload.fixtureDedupeKey"
                  }
                }
              }
            },
            {
              "id": "notify",
              "type": "action.call",
              "config": {
                "actionId": "notifications.send_in_app",
                "version": 1,
                "inputMapping": {
                  "recipients": {
                    "$expr": "{ \"user_ids\": [payload.fixtureNotifyUserId] }"
                  },
                  "title": {
                    "$expr": "vars.title"
                  },
                  "body": {
                    "$expr": "vars.body"
                  },
                  "severity": "info",
                  "dedupe_key": {
                    "$expr": "'fixture.ticket-created-two-subworkflows:' & payload.fixtureDedupeKey & ':child'"
                  }
                }
              }
            },
            {
              "id": "done",
              "type": "control.return"
            }
          ]
        }
      },
      "publishedVersions": []
    }
  ]
}
