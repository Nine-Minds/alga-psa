{
  "format": "alga-psa.workflow-bundle",
  "formatVersion": 1,
  "exportedAt": "2026-01-27T02:06:59.514Z",
  "workflows": [
    {
      "key": "fixture.project-status-multi-branch",
      "metadata": {
        "name": "Fixture: Project Status Multi Branch",
        "description": "Exercise multi-branch control flow by selecting Branch A/B via payload (PROJECT_STATUS_CHANGED).",
        "payloadSchemaRef": "payload.ProjectStatusChanged.v1",
        "payloadSchemaMode": "pinned",
        "pinnedPayloadSchemaRef": "payload.ProjectStatusChanged.v1",
        "trigger": {
          "type": "event",
          "eventName": "PROJECT_STATUS_CHANGED"
        },
        "isSystem": false,
        "isVisible": true,
        "isPaused": false,
        "concurrencyLimit": null,
        "autoPauseOnFailure": false,
        "failureRateThreshold": null,
        "failureRateMinRuns": null,
        "retentionPolicyOverride": null
      },
      "dependencies": {
        "actions": [
          {
            "actionId": "notifications.send_in_app",
            "version": 1
          }
        ],
        "nodeTypes": [
          "action.call",
          "control.return",
          "state.set",
          "transform.assign",
          "control.if"
        ],
        "schemaRefs": [
          "payload.ProjectStatusChanged.v1"
        ]
      },
      "draft": {
        "draftVersion": 1,
        "definition": {
          "id": "76f0a6f1-dc8b-0d45-0329-9546cf4d4fa3",
          "version": 1,
          "name": "Fixture: Project Status Multi Branch",
          "description": "Exercise multi-branch control flow by selecting Branch A/B via payload (PROJECT_STATUS_CHANGED).",
          "payloadSchemaRef": "payload.ProjectStatusChanged.v1",
          "trigger": {
            "type": "event",
            "eventName": "PROJECT_STATUS_CHANGED"
          },
          "steps": [
            {
              "id": "state-fixture",
              "type": "state.set",
              "config": {
                "state": "FIXTURE"
              }
            },
            {
              "id": "assign-text",
              "type": "transform.assign",
              "config": {
                "assign": {
                  "vars.marker": {
                    "$expr": "'[fixture project-status-multi-branch]'"
                  },
                  "vars.body": {
                    "$expr": "'[fixture project-status-multi-branch] dedupe=' & payload.fixtureDedupeKey"
                  }
                }
              }
            },
            {
              "id": "if-branch-a",
              "type": "control.if",
              "condition": {
                "$expr": "payload.fixtureVariant = 'A'"
              },
              "then": [
                {
                  "id": "notify",
                  "type": "action.call",
                  "config": {
                    "actionId": "notifications.send_in_app",
                    "version": 1,
                    "inputMapping": {
                      "recipients": {
                        "$expr": "{ \"user_ids\": [payload.fixtureNotifyUserId] }"
                      },
                      "title": {
                        "$expr": "'[fixture project-status-multi-branch] Branch A'"
                      },
                      "body": {
                        "$expr": "vars.body & ' branch=A'"
                      },
                      "severity": "info",
                      "dedupe_key": {
                        "$expr": "'fixture.project-status-multi-branch:' & payload.fixtureDedupeKey & ':A'"
                      }
                    }
                  }
                },
                {
                  "id": "return-a",
                  "type": "control.return"
                }
              ],
              "else": [
                {
                  "id": "if-branch-b",
                  "type": "control.if",
                  "condition": {
                    "$expr": "payload.fixtureVariant = 'B'"
                  },
                  "then": [
                    {
                      "id": "notify",
                      "type": "action.call",
                      "config": {
                        "actionId": "notifications.send_in_app",
                        "version": 1,
                        "inputMapping": {
                          "recipients": {
                            "$expr": "{ \"user_ids\": [payload.fixtureNotifyUserId] }"
                          },
                          "title": {
                            "$expr": "'[fixture project-status-multi-branch] Branch B'"
                          },
                          "body": {
                            "$expr": "vars.body & ' branch=B'"
                          },
                          "severity": "info",
                          "dedupe_key": {
                            "$expr": "'fixture.project-status-multi-branch:' & payload.fixtureDedupeKey & ':B'"
                          }
                        }
                      }
                    },
                    {
                      "id": "return-b",
                      "type": "control.return"
                    }
                  ],
                  "else": [
                    {
                      "id": "return-default",
                      "type": "control.return"
                    }
                  ]
                }
              ]
            }
          ]
        }
      },
      "publishedVersions": [
        {
          "version": 1,
          "definition": {
            "id": "76f0a6f1-dc8b-0d45-0329-9546cf4d4fa3",
            "version": 1,
            "name": "Fixture: Project Status Multi Branch",
            "description": "Exercise multi-branch control flow by selecting Branch A/B via payload (PROJECT_STATUS_CHANGED).",
            "payloadSchemaRef": "payload.ProjectStatusChanged.v1",
            "trigger": {
              "type": "event",
              "eventName": "PROJECT_STATUS_CHANGED"
            },
            "steps": [
              {
                "id": "state-fixture",
                "type": "state.set",
                "config": {
                  "state": "FIXTURE"
                }
              },
              {
                "id": "assign-text",
                "type": "transform.assign",
                "config": {
                  "assign": {
                    "vars.marker": {
                      "$expr": "'[fixture project-status-multi-branch]'"
                    },
                    "vars.body": {
                      "$expr": "'[fixture project-status-multi-branch] dedupe=' & payload.fixtureDedupeKey"
                    }
                  }
                }
              },
              {
                "id": "if-branch-a",
                "type": "control.if",
                "condition": {
                  "$expr": "payload.fixtureVariant = 'A'"
                },
                "then": [
                  {
                    "id": "notify",
                    "type": "action.call",
                    "config": {
                      "actionId": "notifications.send_in_app",
                      "version": 1,
                      "inputMapping": {
                        "recipients": {
                          "$expr": "{ \"user_ids\": [payload.fixtureNotifyUserId] }"
                        },
                        "title": {
                          "$expr": "'[fixture project-status-multi-branch] Branch A'"
                        },
                        "body": {
                          "$expr": "vars.body & ' branch=A'"
                        },
                        "severity": "info",
                        "dedupe_key": {
                          "$expr": "'fixture.project-status-multi-branch:' & payload.fixtureDedupeKey & ':A'"
                        }
                      }
                    }
                  },
                  {
                    "id": "return-a",
                    "type": "control.return"
                  }
                ],
                "else": [
                  {
                    "id": "if-branch-b",
                    "type": "control.if",
                    "condition": {
                      "$expr": "payload.fixtureVariant = 'B'"
                    },
                    "then": [
                      {
                        "id": "notify",
                        "type": "action.call",
                        "config": {
                          "actionId": "notifications.send_in_app",
                          "version": 1,
                          "inputMapping": {
                            "recipients": {
                              "$expr": "{ \"user_ids\": [payload.fixtureNotifyUserId] }"
                            },
                            "title": {
                              "$expr": "'[fixture project-status-multi-branch] Branch B'"
                            },
                            "body": {
                              "$expr": "vars.body & ' branch=B'"
                            },
                            "severity": "info",
                            "dedupe_key": {
                              "$expr": "'fixture.project-status-multi-branch:' & payload.fixtureDedupeKey & ':B'"
                            }
                          }
                        }
                      },
                      {
                        "id": "return-b",
                        "type": "control.return"
                      }
                    ],
                    "else": [
                      {
                        "id": "return-default",
                        "type": "control.return"
                      }
                    ]
                  }
                ]
              }
            ]
          },
          "payloadSchemaJson": null
        }
      ]
    }
  ]
}
