<!DOCTYPE html>
<html>
<head>
    <title>VNC Exact Test</title>
    <meta charset="utf-8">
    <style>
        body { font-family: monospace; margin: 20px; }
        button { padding: 10px; margin: 5px; font-size: 16px; }
        #status { margin: 20px 0; padding: 10px; background: #f0f0f0; }
        .success { color: green; }
        .error { color: red; }
    </style>
</head>
<body>
    <h1>VNC Exact Connection Test</h1>
    
    <div id="status">
        <p>This page tests the EXACT parameters needed for NoVNC to connect.</p>
        <p>We know from test-ws.html that <code>ws://localhost:30003/vnc/</code> works.</p>
    </div>
    
    <h2>Click to open NoVNC with these exact parameters:</h2>
    
    <button onclick="test1()">Test 1: Minimal (path= empty)</button>
    <button onclick="test2()">Test 2: VNC Lite version</button>
    <button onclick="test3()">Test 3: With explicit WebSocket URL</button>
    
    <h2>Direct WebSocket Test:</h2>
    <button onclick="testWS()">Test WebSocket Connection</button>
    
    <div id="results"></div>
    
    <script>
        function log(msg, isError = false) {
            const div = document.getElementById('results');
            const entry = document.createElement('div');
            entry.className = isError ? 'error' : 'success';
            entry.textContent = new Date().toLocaleTimeString() + ': ' + msg;
            div.appendChild(entry);
        }
        
        function test1() {
            // This should work based on test-ws.html results
            const url = 'vnc.html?autoconnect=true&host=localhost&port=30003&path=&encrypt=false';
            log('Opening: ' + url);
            window.open(url, '_blank');
        }
        
        function test2() {
            // Try the lite version
            const url = 'vnc_lite.html?host=localhost&port=30003&path=&encrypt=false';
            log('Opening: ' + url);
            window.open(url, '_blank');
        }
        
        function test3() {
            // With explicit WebSocket URL
            const wsUrl = 'ws://localhost:30003/vnc/';
            const url = `vnc.html?autoconnect=true&path=${encodeURIComponent(wsUrl)}`;
            log('Opening: ' + url);
            window.open(url, '_blank');
        }
        
        function testWS() {
            log('Testing WebSocket connection...');
            const ws = new WebSocket('ws://localhost:30003/vnc/', ['binary']);
            
            ws.onopen = () => {
                log('✓ WebSocket connected successfully!');
                log('Protocol: ' + ws.protocol);
                ws.close();
            };
            
            ws.onerror = (e) => {
                log('✗ WebSocket error', true);
            };
            
            ws.onclose = (e) => {
                log('WebSocket closed: code=' + e.code + ', reason=' + e.reason);
            };
        }
    </script>
</body>
</html>