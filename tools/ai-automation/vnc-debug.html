<!DOCTYPE html>
<html>
<head>
    <title>VNC Debug</title>
    <meta charset="utf-8">
    <style>
        body { 
            margin: 20px; 
            font-family: monospace; 
            background: #f0f0f0; 
        }
        .info { 
            background: white; 
            padding: 10px; 
            margin: 10px 0; 
            border: 1px solid #ccc; 
        }
        .button {
            padding: 10px 20px;
            margin: 5px;
            cursor: pointer;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
        }
        .button:hover {
            background: #0056b3;
        }
        #log {
            background: black;
            color: green;
            padding: 10px;
            height: 300px;
            overflow-y: auto;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <h1>VNC Connection Debug</h1>
    
    <div class="info">
        <strong>Current Location:</strong> <span id="currentUrl"></span><br>
        <strong>WebSocket URL (default):</strong> <span id="wsUrl"></span><br>
        <strong>Base Path:</strong> <span id="basePath"></span>
    </div>
    
    <div>
        <button class="button" onclick="tryConnect('')">Connect (Default Path)</button>
        <button class="button" onclick="tryConnect('websockify')">Connect (websockify)</button>
        <button class="button" onclick="tryConnect('/vnc/websockify')">Connect (/vnc/websockify)</button>
        <button class="button" onclick="tryConnect('.')">Connect (Same Path)</button>
    </div>
    
    <div class="info">
        <strong>Connection Log:</strong>
        <div id="log"></div>
    </div>
    
    <script>
        const log = (msg) => {
            const logDiv = document.getElementById('log');
            logDiv.innerHTML += new Date().toISOString() + ': ' + msg + '\n';
            logDiv.scrollTop = logDiv.scrollHeight;
        };
        
        // Display current info
        const currentUrl = window.location.href;
        document.getElementById('currentUrl').textContent = currentUrl;
        
        const wsProtocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
        const defaultWsUrl = wsProtocol + '//' + window.location.host + window.location.pathname.replace(/[^\/]*$/, '') + 'websockify';
        document.getElementById('wsUrl').textContent = defaultWsUrl;
        
        const basePath = window.location.pathname.replace(/[^\/]*$/, '');
        document.getElementById('basePath').textContent = basePath;
        
        // Test WebSocket connection
        function tryConnect(path) {
            let wsUrl;
            if (path.startsWith('/')) {
                wsUrl = wsProtocol + '//' + window.location.host + path;
            } else if (path === '') {
                wsUrl = defaultWsUrl;
            } else if (path === '.') {
                wsUrl = wsProtocol + '//' + window.location.host + basePath;
            } else {
                wsUrl = wsProtocol + '//' + window.location.host + basePath + path;
            }
            
            log('Attempting connection to: ' + wsUrl);
            
            try {
                const ws = new WebSocket(wsUrl);
                
                ws.onopen = () => {
                    log('✓ WebSocket opened successfully!');
                    ws.close();
                };
                
                ws.onerror = (e) => {
                    log('✗ WebSocket error: ' + e.type);
                };
                
                ws.onclose = (e) => {
                    log('WebSocket closed: code=' + e.code + ', reason=' + e.reason);
                };
                
            } catch (e) {
                log('✗ Exception: ' + e.message);
            }
        }
        
        // Auto-test default connection
        setTimeout(() => tryConnect(''), 1000);
    </script>
</body>
</html>