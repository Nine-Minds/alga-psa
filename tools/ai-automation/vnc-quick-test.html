<!DOCTYPE html>
<html>
<head>
    <title>VNC Quick Test</title>
    <meta charset="utf-8">
    <style>
        body { font-family: monospace; margin: 20px; }
        .test { margin: 20px 0; padding: 10px; border: 1px solid #ccc; }
        button { padding: 10px; margin: 5px; }
        #log { background: black; color: green; padding: 10px; height: 200px; overflow-y: auto; }
    </style>
</head>
<body>
    <h1>Quick VNC Connection Tester</h1>
    
    <div class="test">
        <h3>1. First, let's copy this into the running container:</h3>
        <pre>kubectl cp vnc-quick-test.html &lt;namespace&gt;/&lt;pod-name&gt;:/usr/share/novnc/quick-test.html -c ai-automation</pre>
    </div>
    
    <div class="test">
        <h3>2. Direct WebSocket Test:</h3>
        <button onclick="testDirectWS()">Test ws://localhost:30003/vnc/</button>
        <button onclick="testNoVNCDefault()">Test NoVNC Default</button>
        <button onclick="testCustomPath()">Test Custom Path</button>
    </div>
    
    <div class="test">
        <h3>3. Try these URLs directly in your browser:</h3>
        <div id="urls"></div>
    </div>
    
    <div id="log"></div>
    
    <script>
        const log = (msg) => {
            const logDiv = document.getElementById('log');
            logDiv.innerHTML += new Date().toISOString() + ': ' + msg + '\n';
            logDiv.scrollTop = logDiv.scrollHeight;
        };
        
        // Generate test URLs
        const baseUrl = window.location.origin;
        const urls = [
            `${baseUrl}/vnc/vnc.html?autoconnect=true&host=${window.location.hostname}&port=${window.location.port}&path=`,
            `${baseUrl}/vnc/vnc.html?autoconnect=true&host=${window.location.hostname}&port=${window.location.port}&path=websockify`,
            `${baseUrl}/vnc/vnc.html?autoconnect=true&path=ws://${window.location.host}/vnc/`,
            `${baseUrl}/vnc/vnc_lite.html?host=${window.location.hostname}&port=${window.location.port}&path=`,
        ];
        
        document.getElementById('urls').innerHTML = urls.map(url => 
            `<div><a href="${url}" target="_blank">${url}</a></div>`
        ).join('');
        
        function testDirectWS() {
            log('Testing direct WebSocket to /vnc/...');
            const ws = new WebSocket('ws://localhost:30003/vnc/', ['binary']);
            ws.onopen = () => log('✓ Connected!');
            ws.onerror = (e) => log('✗ Error: ' + e);
            ws.onclose = (e) => log('Closed: ' + e.code);
        }
        
        function testNoVNCDefault() {
            log('Opening NoVNC with minimal params...');
            window.open('./vnc.html?autoconnect=true', '_blank');
        }
        
        function testCustomPath() {
            const path = prompt('Enter WebSocket path (empty for default):', '');
            const url = `./vnc.html?autoconnect=true&host=${window.location.hostname}&port=${window.location.port}&path=${path}`;
            log('Opening: ' + url);
            window.open(url, '_blank');
        }
    </script>
</body>
</html>