<!DOCTYPE html>
<html>
<head>
    <title>VNC Final Fix</title>
    <meta charset="utf-8">
</head>
<body>
    <h1>VNC Connection - Final Working Configuration</h1>
    
    <p>Based on the logs, the issue is that x11vnc is receiving WebSocket traffic directly.</p>
    <p>This happens when websockify isn't properly translating the protocols.</p>
    
    <h2>Try these configurations:</h2>
    
    <h3>1. NoVNC with explicit empty path (forces base URL):</h3>
    <a href="/vnc/vnc.html?autoconnect=true&path=" target="_blank">
        Connect with empty path
    </a>
    
    <h3>2. NoVNC Lite (simpler, might work better):</h3>
    <a href="/vnc/vnc_lite.html?path=" target="_blank">
        Connect with VNC Lite
    </a>
    
    <h3>3. With explicit localhost (bypass any proxy issues):</h3>
    <a href="/vnc/vnc.html?autoconnect=true&host=localhost&port=30003&encrypt=false&path=" target="_blank">
        Connect with explicit host
    </a>
    
    <script>
        // Log what URL NoVNC would construct
        console.log('Current location:', window.location);
        console.log('NoVNC would use base:', window.location.origin + '/vnc/');
        
        // Test WebSocket directly
        setTimeout(() => {
            console.log('Testing WebSocket...');
            const ws = new WebSocket('ws://localhost:30003/vnc/', ['binary']);
            ws.onopen = () => console.log('✓ WebSocket connected');
            ws.onerror = (e) => console.log('✗ WebSocket error:', e);
            ws.onclose = (e) => console.log('WebSocket closed:', e.code, e.reason);
        }, 1000);
    </script>
</body>
</html>